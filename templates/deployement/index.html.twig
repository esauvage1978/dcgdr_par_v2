{% extends 'base.html.twig' %}

{% block title %} {{ parent() }} Choix des organismes {% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ absolute_url( asset('plugins/datatables-bs4/css/dataTables.bootstrap4.css')) }}">
    <link rel="stylesheet"
          href="{{ absolute_url( asset('plugins/datatables-responsive/css/responsive.bootstrap4.min.css')) }}">
{% endblock %}

{% block body_header %}
    <div class="col">
        <h1 class="m-0 text-dark">Sélection des organismes de l'action {{ action.id }}</h1>
    </div>
    <div class="col">
        <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="{{ path('home') }}">Home</a></li>
            <li class="breadcrumb-item ">
                <a href="{{ path('action_edit',{'id':action.id}) }}#anchor_organisme">Action</a>
            </li>
            <li class="breadcrumb-item active">Sélection des organismes</li>
        </ol>
    </div>
{% endblock %}

{% block body %}


    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-12">
                            <table id="tableAdministration" class="table table-striped table-condensed "
                                   style="width:100%">
                                <thead>
                                <tr>
                                    <th class="all">#</th>
                                    <th class="all">Organisme</th>
                                    <th class="desktop text-center">Nombre d'indicateurs associés</th>
                                    <th class="desktop text-center">Taux</th>
                                    <th class="all text-center"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for organisme in organismes %}
                                    {% set find=false %}
                                    {% for deployement in deployements %}
                                        {% if  deployement.organisme.id == organisme.id %}
                                            {% set find=true %}
                                            <tr>
                                                <td>
                                                    {{deployement.id}}
                                                </td>
                                                <td>
                                                    <span class="text-{{ deployement.organisme.enable ? 'gray-dark' : 'danger text-bold' }}">
                                                        {{ deployement.organisme.name }}
                                                    </span>
                                                </td>
                                                <td class="text-center">
                                                        <span class="text-light" ><i class="fas fa-circle"></i></span>
                                                </td>
                                                <td class="text-center">
                                                    {{ include('share/_taux_progress_bar_label.html.twig', {'taux1': deployement.taux1, 'taux2': deployement.taux2  }) }}
                                                </td>
                                                <td class="d-flex justify-content-center align-items-center">
                                                    {{ include('share/__btn_edit.html.twig',
                                                        {   'url':'deployement_edit',
                                                            'id':deployement.id,
                                                            'sm':true
                                                        }) }}
                                                </td>
                                            </tr>
                                        {% endif %}

                                    {% endfor %}
                                    {% if find==false %}
                                        <tr>
                                            <td>  {{ organisme.id }}</td>
                                            <td>
                                                <span class="text-{{ organisme.enable ? 'gray-dark' : 'danger text-bold' }}">
                                                    {{ organisme.name }}
                                                </span>
                                            </td>
                                            <td> </td>
                                            <td> </td>
                                            <td class="d-flex justify-content-center align-items-center">
                                                <a class="btn btn-success btn-sm" href="{{ path('deployement_new', {'id': action.id, 'organismeid' : organisme.id}) }}">
                                                    <i class="fas fa-plus"></i> Associer l'organisme
                                                </a>
                                            </td>
                                        </tr>
                                    {% endif %}

                                {% else %}
                                    <tr>
                                        <td colspan="5">Aucun d'enregistrement</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

{% endblock %}


{% block javascripts %}
    <script src="{{ absolute_url( asset('plugins/datatables/jquery.dataTables.js')) }}"></script>
    <script src="{{ absolute_url( asset('plugins/datatables-bs4/js/dataTables.bootstrap4.js')) }}"></script>
    <script src="{{ absolute_url( asset('plugins/datatables-responsive/js/dataTables.responsive.min.js')) }}"></script>
    <script src="{{ absolute_url( asset('plugins/datatables-responsive/js/responsive.bootstrap4.min.js')) }}"></script>
    <script>
        $('#tableAdministration').DataTable({
            stateSave: true,
            responsive: true,
            scrollCollapse: true,
            paging: false,
            scrollX: false,
            ordering: true,
            "order": [[1, 'asc']],
            "columns": [
                null,
                null,
                {"orderable": false},
                {"orderable": false},
                {"orderable": false}
            ],
            "language": {
                buttons: {
                    copyTitle: 'Ajouté au presse-papiers',
                    copyKeys: 'Appuyez sur <i>ctrl</i> ou <i>\u2318</i> + <i>C</i> pour copier les données du tableau à votre presse-papiers. <br><br>Pour annuler, cliquez sur ce message ou appuyez sur Echap.',
                    copySuccess: {
                        _: '%d lignes copiées',
                        1: '1 ligne copiée'
                    }
                },
                "sProcessing": "Traitement en cours...",
                "sSearch": "Rechercher&nbsp;:",
                "sLengthMenu": "Afficher _MENU_ &eacute;l&eacute;ments",
                "sInfo": "Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",
                "sInfoEmpty": "Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",
                "sInfoFiltered": "(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",
                "sInfoPostFix": "",
                "sLoadingRecords": "Chargement en cours...",
                "sZeroRecords": "Aucun &eacute;l&eacute;ment &agrave; afficher",
                "sEmptyTable": "Aucune donn&eacute;e disponible dans le tableau",
                "oPaginate": {
                    "sFirst": "Premier",
                    "sPrevious": "Pr&eacute;c&eacute;dent",
                    "sNext": "Suivant",
                    "sLast": "Dernier"
                },
                "oAria": {
                    "sSortAscending": ": activer pour trier la colonne par ordre croissant",
                    "sSortDescending": ": activer pour trier la colonne par ordre d&eacute;croissant"
                },

            }

        });
    </script>
{% endblock %}